{% extends 'base.html' %}
{% block title %}View Records{% endblock %}

{% block body %}
<h2 class="h2_view_records">Uploaded Records</h2>

{% if scans %}
  <div class="scans-grid">
    {% for scan in scans %}
      <div class="scan-card">
        <strong>{{ scan.file_type.upper() }}</strong><br>
        {{ scan.description or 'No description' }}<br>

        {% if scan.file_type == 'dcm' %}
          <img src="{{ scan.jpeg_preview_url }}" alt="Preview" width="200">
          <p><strong>Modality:</strong> {{ scan.modality or 'N/A' }}</p>
          <p><strong>Study Date:</strong> {{ scan.study_date or 'N/A' }}</p>
          <p><strong>Patient Name:</strong> {{ scan.patient_name or 'N/A' }}</p>

        {% elif scan.file_type in ['jpg', 'jpeg', 'png'] %}
          <img src="{{ scan.file_path }}" alt="Preview" width="200"
               alt="Scan Image" class="scan-image">

        {% elif scan.file_type == 'pdf' %}
          <a href="{{ url_for('static', filename='uploads/scans/' + scan.filename) }}" target="_blank">📄 View PDF</a>

        {% else %}
          <a href="{{ url_for('static', filename='uploads/scans/' + scan.filename) }}" target="_blank">
            Download {{ scan.file_type }}
          </a>
        {% endif %}

        <p><em>Uploaded: {{ scan.timestamp|cat_time }}</em></p>

        <!-- View Button -->
        <a href="{{ url_for('static', filename='uploads/scans/' + scan.filename) }}" target="_blank" class="btn-view">👁️</a>

        <!-- Edit Button -->
        <a href="{{ url_for('edit_scan', scan_id=scan.id) }}" class="btn-edit">✏️</a>

        <!-- Delete Button -->
        <form action="{{ url_for('delete_scan', scan_id=scan.id) }}" method="POST" style="display:inline;">
          <button type="submit" class="btn-delete" onclick="return confirm('Are you sure you want to delete this scan?');">🗑️</button>
        </form>
      </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  <div class="pagination">
    {% if pagination.has_prev %}
      <a href="{{ url_for('view_records', page=pagination.prev_num) }}">Previous</a>
    {% endif %}
    <span>Page {{ pagination.page }} of {{ pagination.pages }}</span>
    {% if pagination.has_next %}
      <a href="{{ url_for('view_records', page=pagination.next_num) }}">Next</a>
    {% endif %}
  </div>

{% else %}
  <div class="no-records">
    <p>No patient scan records available.</p>
  </div>
{% endif %}
{% endblock %}
